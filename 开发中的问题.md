## 地图相关

* 问题：openlayers3.0中通过checkbox的勾选在地图上显示不同类型标记，当多次操作后，无法有效删除

* 解决：给不同类型点位添加不同类型的图层进行操作，或者如果想在单个图层操作，每次添加删除时都要将上一次图层layer删除（即保留点位不保留图层）

* 代码：ol-map.js

  
  
* 注意点：leaflet中点标记的图标属性

  * iconSize设置图标大小，比如[50, 60]
  * iconAnchor设置坐标点位于图标的什么位置，初始值位于图标的左上角，比如[25, 60]代表将图标向左平移25单位，向上平移60单位，这样坐标点就会出现在图标的正下方
  * popupAnchor设置弹窗框的位置，比如[0, -60]代表向上位移60个单位，注意这里跟iconAnchor的值恰恰相反

  

* 问题：如何创建3D图层

* 解决：根据返回的json数据判断，是[高德](https://a.amap.com/jsapi_demos/static/data3d/single.json)还是cesium所需的数据格式，一般都是依赖d3bm格式的文件，比较吃内存

  

## 移动端

* 问题：当多级页面来回跳转携带用户操作的信息过多时，代码变得冗余
* 解决：适当讲多级跳转改为当前页面弹窗选择



* 问题：安卓手机上传图片时，小米手机无法上传1M以上图片但华为时不时可以
* 解决：nginx服务端做了限制，解除即可，且华为上传时会自动压缩因此可以上传



* 问题：机型差异导致原生提供的获取定位方法获取失败
* 解决：由于原生那边获取高德地图证书过期，更新即可



* 注意点：vconsole有些请求会自动过滤掉，alert有时候无效等

  

* 问题：使用irz图片压缩时，ios部分机型上传的图片会被旋转90度
* 解决：改用compressorjs插件，或者判断机型进行修正



## Vant

* 问题：vant级联选择器做父子不关联选择，vant选择器做多选
* 解决：自行二次封装



* 注意点：两端的ui组件绑定值的方式不同需要处理，比如选择器在PC端可以展示label绑定value，但是移动端还要通过展示和绑定的都是label需要通过事件参数或者遍历找到对应value，级联选择器、树形选择器更是麻烦需要递归查找



* 注意点：如果想在一个表单项里上传图片和视频两种类型的文件，accept属性以逗号间隔赋值字符串

  

* 问题：非图片类型的文件上传后无法预览，只显示了一个文件icon

* 解决：自定义点击预览图事件@click-preview，这里注意还要处理一下编辑查看状态下回显情况



* 问题：APP内部H5页面上传组件upload针对录制的视频无法使用video标签播放，但是可以用播放软件播放，就是浏览器播不了，另外从本地图库取的视频也可以播放
* 解决：估计是APP内把上传的视频格式做了处理导致video标签识别失败，虽然还是显示mp4格式，APP端采用原生提供的play方法可以播放，PC端暂时无法解决



## JS

* 问题：新版本chrome已经不支持打开页面自动播放声音，需要用户主动行为才能播放
* 解决：网上有很多方法比如muted属性、先pause()再play()，但实际发现都无法完全解决



* 问题：ui框架的级联选择器在使用时，后端返回的数据中父子唯一值不同，父是id，子是child_id，且id和child_id因为来源于两张表，最终只需要child_id，因此前端给子级添加id字段不可取
* 解决：后端重新命名统一的一个父子字段，且保证唯一



* 问题：有时候安装eslint和@babel/eslint-parse会失败，提示冲突
* 解决：有可能是npm版本问题，建议尝试降低到6.14.4



* 问题：【树-地图点位联动】初始化地图上有些点位数据，如何让懒加载数据的tree对应的节点能勾选上
* 思路：因为所有子节点都是在展开时动态加载的，所以只能在每次load加载子节点的时候判断是否在数组内，但是这样会有一个问题就是初始化看不到父节点的选中状态（都是不勾选的），同时还有一个问题就是当你取消某个父节点勾选后，无法准备判断应该删除哪些地图上的点位（因为可能有一部分节节点还没有load展开，不能只根据getCheckedKeys就把其他全部的点位删除掉）
* 解决：在每次load加载的时候把结果存一份到数组A，每次全选/取消全选就去匹配，如果在数组A并且不在当前勾选节点数组B内，就应该从地图上删除该点位，这样的话如果没展开的就不会存入数组A自然也不会被无脑的删除了，但是依旧无法解决未load时全选没有选中状态的问题（设计如此）...



## CSS

* 问题：针对已经有大量自定义样式的element-ui项目进行换肤时，如果用官方方案append新的style标签会导致许多样式被重置且只能替换element-ui组件主题色
* 解决：比较笨拙，直接用js方式替换构建打包后的style标签内容，这个文件比较大所以每次切换时会有顿卡



* 问题：last-of-type和last-child的区别，为什么有时候设置了不生效
* 解决：last-child更加严格，它必须保证有父元素的前提下是最后一个子标签并且class匹配中才能生效。而last-of-type只需要在有父元素下能匹配到class的最后一个***同类标签***（并不需要是这个父元素的最后一个子标签，但是需要是***同类标签***的最后一个，如果不是则不生效）。因此最好保证布局时父容器只包含同类子，不要出现干扰元素！

## VUE

* 问题：项目中可选链(?.)使用报错

* 解决：

  * 1、网上都是需要安装@babel/plugin-proposal-optional-chaining插件来转换，但是我babel的presets使用@vue/cli-plugin-babel/preset时，不安装该插件不会报错~

  * 2、如果需要在template中使用则需要node>=14.0.0且vue>=2.7.0

  * 3、可能是一些相关依赖版本问题导致无法解析，会报loader错误，可尝试更新依赖

    

* 问题：vue3中setup语法如何设置页面的name

* 解决：再写一个script标签里面设置name: 'xxx'



* 问题：分页列表前端保存已勾选的数据时，切换页码保存不住
* 解决：一定要在每次切换分页时先清空列表数据，不然每次切换都会自动触发select事件导致逻辑混乱



* 问题：@vue/cli-service中，如果publicPath配置了二级目录/mqwb，http请求也代理了某个请求前缀/mqwb-api，那么history模式会发生冲突导致本地开发时页面刷新404
* 解决：^/mqwb/请求api代理时在后面多加一个斜杠用来防止模糊匹配到publicPath目录



* 注意点：能用弹窗的尽量不用二级页面跳转，能用列表分页查询的尽量不用动态加载树形数据



## 小程序

* 问题：项目工期紧张，需要在小程序中嵌入已有的H5项目
* 解决：不能用原生开发，使用uniapp开发打包成小程序，但是同时嵌入的H5会有一些兼容性问题



* 问题：正式环境接口失败
* 解决：域名没有做映射配置、ssl证书是否过期或配置不当



* 问题：正式环境通过WXBizDataCrypt解密手机号失败，其他环境OK
* 解决：选择在解密失败后调用后端封装的官方/getuserphonenumber接口获取手机号，需要前端传code



* 问题：项目工期紧张，需要把之前的小程序项目转换成H5用于上架浙里办应用
* 解决：[minprogram-to-uniapp](https://gitee.com/zhangdaren/miniprogram-to-uniapp/)，但是会有一些兼容性问题，比如：一些依赖不识别、不建议转换@vant/weapp项目不然要手动替换其他ui框架、部分js方法需要替换比如tap事件、只支持原生小程序项目不适合uniapp小程序、一些获取小程序的api如getAccountInfoSync获取用户信息失效报错等



* 问题：uView中select组件，需求是需要在有三级联动选项的前提下，能选二级

* 解决：由于组件不支持，只能选择把二级的选项加到三级首位，或者新增一个select用来专门选三级

  

* 问题：uView的swiper无法自定义slot内容，比如有时候需要轮播视频

* 解决：用了一张播放图片代替，点击打开预览弹窗

  

* 问题：使用rich-text标签或者v-html插入内容时候，video标签无法正常显示
* 解决：处理字符串，分割video标签的内容，遍历渲染节点，视频单独用video标签显示，其他照旧用rich-text



## 浙里办

* 问题：打包上传irs后页面访问空白
* 解决：webpack的publicPath需要设置成相对路径（./），outputDir必须设置成（build）目录，如果判断未登录则跳转到登陆页面，地址（https://puser.zjzwfw.gov.cn/sso/mobile.do?action=oauth&scope=1&servicecode=你的ak值&redirectUrl=' + process.env.VUE_APP_REDIRECT_URL）



* 问题：顶部导航栏如何去除浙里办自带的
* 解决：目前没找到对应方法，所以删除了H5的导航栏，通过ZWJSBridge.setTitle设置不同页面title



* 问题：单点登陆时如何拿到浙里办用户信息
* 解决：必须由后端根据文档发送请求获得，前端仅提供页面跳转后url上自带的ticket票据凭证作为参数



* 问题：埋点统计的请求vconsole无法看到

* 解决：需要下载政务中台debug工具，登陆账号（pm提供）后手机扫码调试

  

* 问题：在浙里办内上传组件无法唤起摄像头（安卓机），但微信等其他内置浏览器打开可以

* 解决：需要调用浙里办的jsBridge提供的api，但是没有提供录像功能

  

* 问题：上传最新代码后，页面未更新

* 解决：正式环境回调地址需要用发布后生成的https://mapi.zjzwfw.gov.cn/xxx，不是用申请的域名，申请的域名只是作为请求的代理地址

  

* 问题：首页退出要双击两次返回按钮才能退出

* 解决：设置一个空白页，初始化跳转到首页，然后在beforeRouteEnter路由钩子中判断跳转来源，调用jsBridge的close方法关闭页面（仅在浙里办环境下该API才能生效）

  

* 问题：支付宝的浙里办小程序登陆有可能会空白页

* 解决：原因是jsBridge在一些环境下初始化失败阻塞了代码的执行........因此我选择在vue初始化成功后，在App.vue中做延迟回调来加载jsBridge




* 问题：微信端的拨打电话方法需要双击才能唤起（仅ios手机）
* 解决：click事件替换成touchstart或者用fastclick插件，推荐用touch事件



* 问题：微信端的拍照上传图片偶尔会出现页面自动刷新的情况
* 解决：内存溢出导致的，检查是否图片是base64导致数据量过大，也是jsBridge的api自身的缺陷，因此推荐使用上传到irs服务器（即设置upload为true）之后返回url链接，然后通过图片url转file对象方法，来调用我们自己的上传接口



* 注意点：适老化不能使用flexible.js，需要手动根据ZWJSBridge.getUiStyle方法来判断返回用户类型，从而适配不同样式方案，如果页面简单可以修改html的font-size，如果页面复杂需要设计两套样式



* 注意点：上架正式环境时，irs上是没有环境变量判断的（暂时没找到提供的API），它只会运行npm run build，所以需要修改对应配置文件为生产配置再上传irs



* 注意点：微信端的浙里办小程序在未上架前都是测试账号，包括ticket/token/userId等等



* 注意点：微信/支付宝端的浙里办小程序必须要发布后才能调试，无法本地调试，且无法使用政务中台debug工具

  

* 注意点：微信端的浙里办小程序用jsBridge方法来拍照上传后图片并非完整的base64格式，需要手动在前面拼接data:image/jpeg;base64,字符（仅安卓手机）

  

* 注意点：jsBridge对支付宝端浙里办有部分功能无法支持，比如获取UI风格来适老化，具体见[官方API](https://op-irs.zj.gov.cn/mobile/documents/technology/1714076105479)



## 支付宝

* 问题：上传组件无法区分仅拍照和仅录屏
* 解决：暂未解决